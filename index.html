<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ProComic v2 — Chapters & Load</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#071129; --panel:#0f1724; --accent:#7b61ff; --accent2:#00ffd5; --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,var(--bg1),#021028);color:#eaf6ff}
.app{display:flex;height:100vh;overflow:hidden}

/* sidebar */
.sidebar{
  width:320px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;box-shadow:inset -8px 0 40px rgba(0,0,0,0.5);overflow:auto;
}
.brand{display:flex;gap:10px;align-items:center;margin-bottom:12px}
.logo{width:46px;height:46px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#021}
.h1{font-weight:800}
.side-section{margin-top:12px}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.btn{padding:8px 10px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#021;font-weight:700;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#eaf6ff}
.small{padding:6px 8px;font-size:13px}

/* chapter list */
.chapters{margin-top:12px;display:flex;flex-direction:column;gap:8px}
.chapter{padding:10px;border-radius:8px;background:var(--glass);display:flex;align-items:center;justify-content:space-between;cursor:pointer}
.chapter.active{box-shadow:0 10px 30px rgba(0,0,0,0.6);border:1px solid rgba(123,97,255,0.12);transform:scale(1.01)}
.chapter .title{font-weight:700}

/* uploader */
.uploader{margin-top:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);padding:10px;border-radius:8px}
textarea.urlbox{width:100%;height:80px;background:transparent;border:1px dashed rgba(255,255,255,0.06);color:#eaf6ff;padding:8px;border-radius:8px;resize:vertical}

/* main viewer */
.viewer-wrap{flex:1;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;padding:10px}
.topbar{position:absolute;left:20px;right:20px;top:16px;display:flex;align-items:center;justify-content:space-between;z-index:80}
.top-left{display:flex;gap:8px;align-items:center}
.title-big{font-family:"Bebas Neue";font-size:20px}
.top-right{display:flex;gap:8px;align-items:center}
.stage{width:100%;height:100%;display:flex;align-items:center;justify-content:center;position:relative}
.page{max-width:1200px;max-height:86vh;width:calc(100% - 40px);height:auto;border-radius:12px;background:var(--panel);box-shadow:0 30px 90px rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
.page img{max-width:100%;max-height:86vh;height:auto;user-select:none;pointer-events:none;transition:transform .2s ease}
.nav-left,.nav-right{position:absolute;top:50%;transform:translateY(-50%);z-index:70;width:76px;height:120px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.nav-left{left:8px} .nav-right{right:8px}
.nav{width:56px;height:56px;border-radius:50%;background:rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;font-weight:800}

/* thumbs bar */
.thumbs{position: absolute;left:20px;bottom:20px;right:20px;display:flex;gap:8px;padding:8px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);backdrop-filter: blur(6px);overflow:auto;z-index:60}
.thumb{width:100px;height:62px;border-radius:6px;overflow:hidden;flex:0 0 auto;border:2px solid rgba(255,255,255,0.03);cursor:pointer;display:flex;align-items:center;justify-content:center}
.thumb img{width:100%;height:100%;object-fit:cover;display:block}
.thumb.active{transform:scale(1.06);border-color:var(--accent)}

/* footer */
.footer{position:absolute;left:20px;right:20px;bottom:6px;display:flex;align-items:center;justify-content:space-between;z-index:80}
.pager{display:flex;gap:8px;align-items:center}
.progress{height:8px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden;width:320px}
.progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%}

/* modal small */
.modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:120;opacity:0;pointer-events:none;transition:opacity .2s}
.modal.show{opacity:1;pointer-events:auto}
.modal .box{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.02));padding:16px;border-radius:10px;min-width:320px;text-align:center}
.input{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#eaf6ff}

/* responsive */
@media (max-width:980px){
  .sidebar{width:100%;position:absolute;top:0;left:0;z-index:200;height:40vh;overflow:auto}
  .app{flex-direction:column}
  .viewer-wrap{height:60vh}
}
</style>
</head>
<body>
<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="brand">
      <div class="logo">PC</div>
      <div>
        <div class="h1">ProComic v2</div>
        <div style="font-size:13px;color:rgba(230,240,255,0.7)">Chapters • Upload • Read mode</div>
      </div>
    </div>

    <div class="side-section">
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="newChapterBtn">+ Tạo chương</button>
        <button class="btn ghost" id="importBtn">Import JSON</button>
        <button class="btn ghost" id="exportBtn">Export JSON</button>
      </div>
    </div>

    <div class="side-section">
      <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
        <label style="font-size:13px">Chế độ đọc:</label>
        <select id="readMode" class="small" style="background:transparent;color:#eaf6ff;border:1px solid rgba(255,255,255,0.06);border-radius:8px;padding:6px">
          <option value="ltr">Left → Right</option>
          <option value="rtl">Right → Left</option>
        </select>
      </div>
    </div>

    <div class="side-section">
      <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
        <label style="font-size:13px">Chọn chương để quản lý (click vào tên):</label>
      </div>
      <div class="chapters" id="chapters"></div>
    </div>

    <div class="side-section uploader" id="uploaderPanel" style="display:none">
      <div style="display:flex;gap:8px;align-items:center">
        <input type="file" id="fileInput" accept="image/*" multiple />
        <button class="btn small" id="addFilesBtn">Thêm file</button>
      </div>
      <div style="margin-top:8px;font-size:13px;color:rgba(230,240,255,0.7)">Hoặc dán danh sách URL (mỗi URL 1 dòng):</div>
      <textarea class="urlbox" id="urlBox" placeholder="https://.../page1.jpg\nhttps://.../page2.jpg"></textarea>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn small" id="addUrlsBtn">Thêm URL</button>
        <button class="btn ghost small" id="clearUrlsBtn">Xóa textbox</button>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn ghost small" id="reorderBtn">Bật/tắt reorder (kéo thumbnails)</button>
        <button class="btn ghost small" id="deleteChapterBtn">Xóa chương này</button>
      </div>
    </div>

    <div style="margin-top:18px;font-size:12px;color:rgba(230,240,255,0.6)">
      Ghi chú: dữ liệu chương & trang được lưu local trong trình duyệt (localStorage). Dùng Export/Import để backup hoặc share.
    </div>
  </aside>

  <!-- Viewer -->
  <main class="viewer-wrap">
    <div class="topbar">
      <div class="top-left">
        <div class="title-big" id="currentChapterTitle">—</div>
        <div style="margin-left:12px;color:rgba(230,240,255,0.7);font-size:13px" id="chapterCount">0 trang</div>
      </div>
      <div class="top-right">
        <button class="btn ghost" id="prevBtn">Prev</button>
        <button class="btn ghost" id="nextBtn">Next</button>
        <button class="btn" id="fsBtn">Fullscreen</button>
        <button class="btn" id="autoBtn">Autoplay</button>
      </div>
    </div>

    <div class="stage" id="stage">
      <div class="nav-left" id="navLeft"><div class="nav">◀</div></div>
      <div class="page" id="page">
        <img id="pageImg" src="" alt="Trang"/>
      </div>
      <div class="nav-right" id="navRight"><div class="nav">▶</div></div>

      <div class="thumbs" id="thumbs"></div>
      <div class="hint" style="position:absolute;right:20px;bottom:100px;color:rgba(230,240,255,0.75)">Swipe / ← → / click thumb</div>
    </div>

    <div class="footer">
      <div class="pager">
        <div id="pageLabel" style="font-weight:700">0 / 0</div>
        <div style="width:8px"></div>
        <div class="progress"><i id="progressBar"></i></div>
      </div>
      <div style="color:rgba(230,240,255,0.7);font-size:13px" id="clock"></div>
    </div>
  </main>
</div>

<!-- modal import -->
<div class="modal" id="modalImport"><div class="box">
  <div style="font-weight:800;margin-bottom:8px">Import project (JSON)</div>
  <input type="file" id="importFile" accept=".json" class="input" />
  <div style="display:flex;gap:8px;margin-top:8px;justify-content:center">
    <button class="btn" id="doImport">Import</button>
    <button class="btn ghost" id="closeImport">Close</button>
  </div>
</div></div>

<script>
/* --------- State ------------- */
const STORAGE_KEY = 'procomics_v2_project';
let project = { chapters: [] }; // each chapter: { id, title, pages: [url,...] }
let current = { chapterIndex: -1, pageIndex: 0 };
let autoplay = false, autoplayTimer = null;
let readMode = 'ltr'; // or 'rtl'

/* --------- DOM refs --------- */
const chaptersEl = document.getElementById('chapters');
const newChapterBtn = document.getElementById('newChapterBtn');
const uploaderPanel = document.getElementById('uploaderPanel');
const fileInput = document.getElementById('fileInput');
const addFilesBtn = document.getElementById('addFilesBtn');
const urlBox = document.getElementById('urlBox');
const addUrlsBtn = document.getElementById('addUrlsBtn');
const clearUrlsBtn = document.getElementById('clearUrlsBtn');
const reorderBtn = document.getElementById('reorderBtn');
const deleteChapterBtn = document.getElementById('deleteChapterBtn');
const readModeSel = document.getElementById('readMode');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const fsBtn = document.getElementById('fsBtn');
const autoBtn = document.getElementById('autoBtn');
const pageImg = document.getElementById('pageImg');
const pageEl = document.getElementById('page');
const thumbsEl = document.getElementById('thumbs');
const pageLabel = document.getElementById('pageLabel');
const progressBar = document.getElementById('progressBar');
const currentChapterTitle = document.getElementById('currentChapterTitle');
const chapterCount = document.getElementById('chapterCount');
const modalImport = document.getElementById('modalImport');
const importFile = document.getElementById('importFile');
const doImport = document.getElementById('doImport');
const closeImport = document.getElementById('closeImport');
const importBtn = document.getElementById('importBtn');
const exportBtn = document.getElementById('exportBtn');
const newChapterInputPrompt = () => prompt('Tên chương mới (ví dụ: Chương 1, Volume 2):','Chương mới');

/* --------- Helpers ------------ */
function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9); }
function saveProject(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(project)); }
function loadProject(){ try{ const raw = localStorage.getItem(STORAGE_KEY); if(raw) project = JSON.parse(raw); }catch(e){ project = { chapters:[] }; } }
function formatCount(n){ return n + (n>1? ' trang':' trang'); }

/* --------- Render chapters list ------- */
function renderChapters(){
  chaptersEl.innerHTML = '';
  project.chapters.forEach((ch, i)=>{
    const el = document.createElement('div');
    el.className = 'chapter' + (i===current.chapterIndex? ' active':'');
    el.innerHTML = `<div style="display:flex;gap:8px;align-items:center"><div class="title">${ch.title}</div><div style="font-size:12px;color:rgba(230,240,255,0.6);margin-left:8px">${ch.pages.length}</div></div>
                    <div style="display:flex;gap:6px">
                      <button class="btn ghost small" data-act="rename" data-i="${i}">Rename</button>
                      <button class="btn ghost small" data-act="open" data-i="${i}">Open</button>
                    </div>`;
    chaptersEl.appendChild(el);

    el.querySelector('[data-act="open"]').addEventListener('click', ()=> openChapter(i));
    el.querySelector('[data-act="rename"]').addEventListener('click', ()=>{
      const name = prompt('Đổi tên chương:', ch.title);
      if(name && name.trim()){ ch.title = name.trim(); saveProject(); renderChapters(); renderUI(); }
    });
  });
}

/* --------- Chapter ops --------- */
function createChapter(name){
  const ch = { id: uid('ch'), title: name||('Chương ' + (project.chapters.length+1)), pages: [] };
  project.chapters.push(ch);
  saveProject(); renderChapters();
  openChapter(project.chapters.length-1);
}

function openChapter(index){
  if(index<0 || index>=project.chapters.length) return;
  current.chapterIndex = index;
  current.pageIndex = 0;
  renderChapters();
  renderUI();
  showUploaderPanel(true);
}

function deleteChapter(index){
  if(!confirm('Xóa chương này? Hành động không thể hoàn tác.')) return;
  project.chapters.splice(index,1);
  saveProject();
  current.chapterIndex = project.chapters.length? 0 : -1;
  current.pageIndex = 0;
  renderChapters();
  renderUI();
}

/* --------- Uploader panel --------- */
function showUploaderPanel(show){
  uploaderPanel.style.display = show? 'block' : 'none';
  if(!show) return;
  // set state of delete btn
  deleteChapterBtn.onclick = ()=>{ if(current.chapterIndex>=0) deleteChapter(current.chapterIndex); };
}

/* --------- Add files / urls ---------- */
addFilesBtn.addEventListener('click', ()=> fileInput.click());
fileInput.addEventListener('change', async (e)=>{
  const files = Array.from(e.target.files || []);
  if(!files.length || current.chapterIndex<0) return;
  // read files as object URLs
  for(const f of files){
    const url = URL.createObjectURL(f);
    project.chapters[current.chapterIndex].pages.push(url);
  }
  saveProject(); renderUI();
  fileInput.value = '';
});

addUrlsBtn.addEventListener('click', ()=>{
  const txt = urlBox.value.trim();
  if(!txt || current.chapterIndex<0) return;
  const lines = txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  project.chapters[current.chapterIndex].pages.push(...lines);
  saveProject(); renderUI();
  urlBox.value = '';
});

clearUrlsBtn.addEventListener('click', ()=> urlBox.value = '');

/* --------- Thumbnails & reorder ---------- */
function renderThumbnails(){
  thumbsEl.innerHTML = '';
  const ch = project.chapters[current.chapterIndex];
  if(!ch) return;
  const pages = (readMode==='ltr') ? ch.pages : [...ch.pages].slice().reverse();
  pages.forEach((src, i)=>{
    const t = document.createElement('div'); t.className='thumb';
    const im = document.createElement('img'); im.src = src; im.alt = 'T'+(i+1);
    t.appendChild(im);
    const realIndex = (readMode==='ltr') ? i : (ch.pages.length - 1 - i);
    t.addEventListener('click', ()=> goTo(realIndex));
    if(realIndex === current.pageIndex) t.classList.add('active');
    // drag reorder (simple)
    t.draggable = true;
    t.addEventListener('dragstart', (e)=> { e.dataTransfer.setData('text/plain', realIndex); setTimeout(()=> t.style.opacity=0.4,50); });
    t.addEventListener('dragend', ()=> t.style.opacity=1);
    t.addEventListener('dragover', (e)=> e.preventDefault());
    t.addEventListener('drop', (e)=> {
      e.preventDefault();
      const from = parseInt(e.dataTransfer.getData('text/plain'));
      const to = realIndex;
      if(Number.isFinite(from) && Number.isFinite(to) && from!==to){
        const arr = ch.pages;
        const item = arr.splice(from,1)[0];
        arr.splice(to,0,item);
        saveProject(); renderThumbnails(); renderUI();
      }
    });
    thumbsEl.appendChild(t);
  });
}

/* --------- Render UI / page ---------- */
function renderUI(){
  if(current.chapterIndex<0){
    currentChapterTitle.textContent = 'Chưa có chương';
    chapterCount.textContent = '0 trang';
    pageImg.src = '';
    pageLabel.textContent = '0 / 0';
    progressBar.style.width = '0%';
    thumbsEl.innerHTML = '';
    showUploaderPanel(false);
    return;
  }
  const ch = project.chapters[current.chapterIndex];
  currentChapterTitle.textContent = ch.title;
  chapterCount.textContent = formatCount(ch.pages.length);
  if(ch.pages.length===0){
    pageImg.src = '';
    pageLabel.textContent = '0 / 0';
    progressBar.style.width = '0%';
    thumbsEl.innerHTML = '';
    return;
  }
  // clamp pageIndex
  current.pageIndex = Math.max(0, Math.min(current.pageIndex, ch.pages.length-1));
  pageImg.src = ch.pages[current.pageIndex];
  pageLabel.textContent = (current.pageIndex+1) + ' / ' + ch.pages.length;
  progressBar.style.width = (((current.pageIndex+1)/ch.pages.length)*100)+'%';
  renderThumbnails();
  showUploaderPanel(true);
}

/* --------- Navigation ---------- */
function goTo(i){
  const ch = project.chapters[current.chapterIndex];
  if(!ch) return;
  if(readMode==='rtl'){
    // in rtl, natural order reversed for UI navigation: next -> previous index
  }
  current.pageIndex = Math.max(0, Math.min(i, ch.pages.length-1));
  renderUI();
}
function next(){
  if(current.chapterIndex<0) return;
  const ch = project.chapters[current.chapterIndex];
  if(readMode==='ltr'){
    if(current.pageIndex < ch.pages.length-1) current.pageIndex++;
    else { /* optionally move to next chapter */ }
  } else {
    if(current.pageIndex > 0) current.pageIndex--;
  }
  renderUI();
}
function prev(){
  if(current.chapterIndex<0) return;
  const ch = project.chapters[current.chapterIndex];
  if(readMode==='ltr'){
    if(current.pageIndex > 0) current.pageIndex--;
  } else {
    if(current.pageIndex < ch.pages.length-1) current.pageIndex++;
  }
  renderUI();
}

/* --------- Fullscreen & autoplay ---------- */
fsBtn.addEventListener('click', ()=> {
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen?.();
  } else {
    document.exitFullscreen?.();
  }
});
autoBtn.addEventListener('click', ()=> { if(autoplay) stopAuto(); else startAuto(); });
function startAuto(){
  if(current.chapterIndex<0) return;
  autoplay = true; autoBtn.textContent = 'Stop';
  autoplayTimer = setInterval(()=> {
    // advance respecting readMode
    if(readMode==='ltr') {
      if(current.pageIndex < project.chapters[current.chapterIndex].pages.length-1) next();
      else stopAuto();
    } else {
      if(current.pageIndex > 0) prev();
      else stopAuto();
    }
  }, 2500);
}
function stopAuto(){
  autoplay = false; autoBtn.textContent = 'Autoplay';
  clearInterval(autoplayTimer); autoplayTimer = null;
}

/* --------- Keyboard & touch ---------- */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'ArrowRight') {
    if(readMode==='ltr') next(); else prev();
  }
  if(e.key === 'ArrowLeft') {
    if(readMode==='ltr') prev(); else next();
  }
  if(e.key === 'f') fsBtn.click();
  if(e.key === ' ') { e.preventDefault(); if(autoplay) stopAuto(); else startAuto(); }
});

/* touch swipe */
let touchStartX = null;
pageEl.addEventListener('touchstart', (e)=> { if(e.touches && e.touches[0]) touchStartX = e.touches[0].clientX; }, {passive:true});
pageEl.addEventListener('touchend', (e)=> {
  if(!touchStartX) return;
  const dx = (e.changedTouches[0].clientX - touchStartX);
  if(dx < -60) { if(readMode==='ltr') next(); else prev(); }
  if(dx > 60) { if(readMode==='ltr') prev(); else next(); }
  touchStartX = null;
}, {passive:true});

/* --------- Zoom & drag ---------- */
let scale = 1, ox = 0, oy = 0, dragging = false, lastX=0, lastY=0;
function resetZoom(){ scale=1; ox=0; oy=0; applyTransform();}
function applyTransform(){ pageImg.style.transform = `translate(${ox}px,${oy}px) scale(${scale})`; }
pageEl.addEventListener('dblclick', ()=> {
  if(scale === 1) { scale=2; } else { scale=1; ox=0; oy=0; }
  applyTransform();
});
pageEl.addEventListener('pointerdown', (e)=>{ dragging = true; lastX = e.clientX; lastY = e.clientY; pageEl.setPointerCapture?.(e.pointerId); });
pageEl.addEventListener('pointermove', (e)=>{ if(!dragging) return; const dx = e.clientX - lastX; const dy = e.clientY - lastY; lastX = e.clientX; lastY = e.clientY; if(scale>1){ ox += dx; oy += dy; applyTransform(); } else { if(Math.abs(dx)>30){ if(dx>0) prev(); else next(); dragging=false; } } });
pageEl.addEventListener('pointerup', ()=> { dragging = false; });
pageEl.addEventListener('wheel', (e)=> {
  if(e.ctrlKey) {
    e.preventDefault();
    scale = Math.max(1, Math.min(4, scale - e.deltaY * 0.0015));
    applyTransform();
  }
}, {passive:false});

/* --------- Import / Export project JSON --------- */
exportBtn.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(project, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = 'procomic_project.json'; document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=> URL.revokeObjectURL(url), 2000);
});

importBtn.addEventListener('click', ()=> { modalImport.classList.add('show'); });
closeImport.addEventListener('click', ()=> { modalImport.classList.remove('show'); importFile.value=''; });
doImport.addEventListener('click', ()=> {
  const f = importFile.files[0]; if(!f) return alert('Chọn file JSON trước');
  const reader = new FileReader();
  reader.onload = ()=> {
    try{
      const data = JSON.parse(reader.result);
      if(data && Array.isArray(data.chapters)){
        project = data;
        saveProject(); renderChapters(); if(project.chapters.length) openChapter(0); modalImport.classList.remove('show'); importFile.value=''; alert('Import xong');
      } else alert('File không đúng định dạng');
    }catch(e){ alert('Import lỗi: ' + e.message); }
  };
  reader.readAsText(f);
});

/* --------- Init: load project from storage --------- */
function init(){
  loadProject();
  renderChapters();
  // auto open first chapter if available
  if(project.chapters.length){
    current.chapterIndex = 0;
    current.pageIndex = 0;
    renderUI();
  } else {
    // create a sample chapter to start
    createChapter('Chương mẫu');
  }
  // UI events
  newChapterBtn.addEventListener('click', ()=> {
    const name = newChapterInputPrompt();
    if(name && name.trim()) createChapter(name.trim());
  });
  reorderBtn.addEventListener('click', ()=> alert('Để sắp xếp thứ tự trang: kéo thumbnails (bấm giữ sau đó thả vào vị trí mới).'));
  prevBtn.addEventListener('click', ()=> prev());
  nextBtn.addEventListener('click', ()=> next());
  readModeSel.addEventListener('change', (e)=> { readMode = e.target.value; saveProject(); renderUI(); });
  // small clock
  setInterval(()=> document.getElementById('clock').textContent = new Date().toLocaleString(), 1000);
}

init();

/* expose helper for console */
window.PROCOMIC = { project, save: saveProject, reset: ()=>{ localStorage.removeItem(STORAGE_KEY); location.reload(); } };

</script>
</body>
</html>
